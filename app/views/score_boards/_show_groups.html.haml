- groups.each_with_index do |g,i| 
  .panel.panel-default
    .panel-heading
      %h4.panel-title
        %a{"data-parent" => "#accordion", "data-toggle" => "collapse", href: "#collapse#{i}"}
          %h3= "Group " + g.name
    .panel-collapse.collapse.in{id: "collapse#{i}"}
      .panel-body
        - matches = g.matches_for_score_board_group(@score_board)
        .span7
          - matches.each_with_index do |m,i|
            .row
              - team_1 = m.team_1
              - team_2 = m.team_2
              - @score = m.score
              - @score = Score.new if m.score.nil?
              .span3.team-name
                %p= team_1.name
                = image_tag team_1.flag
              .span6
                = form_for @score, remote: true  do |f|
                  .span5
                    = f.text_field :team_1_goals, required: true, class: "form-control form-input"
                    %p= m.day
                    %p= m.city
                  .span1
                    %p{style: "display:inline;"} -
                  .span5
                    = f.text_field :team_2_goals, required: true, class: "form-control form-input"
                    %p= m.time
                  = f.hidden_field :scoreboard_id, value: @score_board.id
                  = f.hidden_field :match_id, value: m.id
                  = f.hidden_field :can_change, value: true
                  - if !is_main
                    .div{style: "visibility:hidden;"}
                      = f.submit 'Guardar', class: "scores"
                  - else
                    - if @score.can_change || @score.id.nil?
                      = f.submit 'Guardar', class: "scores btn btn-success"

              .span3.team-2-name
                %p= m.team_2.name
                = image_tag team_2.flag
          .row.span3
            - if !is_main
              %button.btn.btn-success{class: "js-save-group"}
                Guardar
            
        .span5
          %table.table{style: "float:right"}
            %thead
              %th Teams
              %th J
              %th G
              %th E
              %th P
              %th GF
              %th GC
              %th DIF
              %th PTS
              %th
            %tbody
              - g.teams.each_with_index do |t, index|
                - ts = t.team_stats.where(score_board_id: @score_board.id).first
                - check = false
                - if ts.position != 0
                  - g.teams.each do |t1|
                    - t1s = t1.team_stats.where(score_board_id: @score_board.id).first
                    - unless t1s == ts
                      - if ts.same_position_as(t1s)
                        - check = true
                %tr
                  %td= t.name
                  %td{id: t.id.to_s + "J"}= ts.played_games
                  %td{id: t.id.to_s + "G"}= ts.won_games
                  %td{id: t.id.to_s + 'E'}= ts.tied_games
                  %td{id: t.id.to_s + 'P'}= ts.lost_games
                  %td{id: t.id.to_s + 'GF'}= ts.goals_favor
                  %td{id: t.id.to_s + 'GC'}= ts.goals_aggainst
                  %td{id: t.id.to_s + 'DIF'}= ts.goals_favor - ts.goals_aggainst
                  %td{id: t.id.to_s + 'PTS'}= ts.points
                  %td{id: t.id.to_s + 'LD'}= ts.final_position
                  - if check
                    %td{id: t.id.to_s + 'final'}
                      %input{type: 'radio', name: "team_s_radio_#{g.id}"}

- if is_main
  = link_to finish_phase_score_board_path(@score_board, :phase => Match::R16_MAIN), remote: true do
    %button.btn.btn-success{style: "float:right;"}
      Terminar etapa
- content_for(:javascript) do

  :coffeescript
    jQuery(".js-save-group").click ->
      console.log "Pressed"
      scores = jQuery(this).parent().siblings().find("form")

      scores.each (index) ->
        console.log "Verifico cada score"
        $(this).validate rules:
          'score[team_1_goals]':
            required: true
            min: 0
        $(this).validate rules:
          'score[team_2_goals]':
            required: true
            min: 0
        $(this).submit()